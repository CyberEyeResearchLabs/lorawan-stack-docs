<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.70.0" />
  <title>Monitoring | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/monitoring/" />
  <link rel="alternate icon" href="/docs/favicon.ico">
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.db043375ab9a68ad2c8c4e45b432617be913b8b857768ffc17e743cfeb4080f3.css" integrity="sha256-2wQzdauaaK0sjE5FtDJhe&#43;kTuLhXdo/8F&#43;dDz&#43;tAgPM=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Monitoring">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Monitoring">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/monitoring/">
  <meta name="twitter:title" content="Monitoring" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>
<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div id="migration-info">
      <div id="migration-text">thethingsstack.io has moved to thethingsindustries.com/docs</div>
      <div id="migration-button" class="button is-primary">Got it</div>
  </div>
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.11</p>
      </a>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>
      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="/docs/download/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav>
<section class="search-container">
    <div class="container">
      <div class="columns is-vcentered">
        <div class="column">
          <div class="field has-addons has-addons-centered">
            <div class="control">
              <input class="input search-bar" id="search-input" type="text" placeholder="Search" type="text">
            </div>
          </div>
        </div>
      </div>
    </div>
</section>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: "",
indexName: "thethingsstack",
inputSelector: '#search-input',
debug: false 
});
</script>
<div class="container" role="document">
  <div class="columns my-0">
      <div class="column is-one-fifth-tablet is-one-third sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Getting Started</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/getting-started/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/what-is-tts/" class="">What Is The Things Stack?</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/installation/" class="">Installing The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/migrating/" class="">Migrating to The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/upgrading/" class="">Upgrading The Things Stack</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cloud-hosted/" class="">The Things Stack Cloud</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/" class="">AWS</a>
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ami/" class="">AWS Marketplace AMI</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/" class="">AWS ECS</a>
    
    


<ul class="menu-list">

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/architecture/" class="">Architecture</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/prerequisites/" class="">Prerequisites</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/deployment/" class="">Deployment</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/database-operations/" class="">Database Operations</a>
    
  </li>

  <li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/monitoring/" class="is-active">Monitoring</a>
    
    



    
  </li>

</ul>


    
  </li>

</ul>


    
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/cli/" class="">Command-line Interface</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/console/" class="">Console</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/troubleshooting/" class="">Troubleshooting Getting Started</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/user-management/" class="">Users and Organizations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/api/" class="">Using the API</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/getting-started/events/" class="">Working with Events</a>
  </li>
</ul>



</nav>








      </div>
      <div class="column sidebar-middle">

<div class="docs-content">
<h1 class="title is-size-2">Monitoring
  
  
  
  
</h1>

<div class="content">
  <p>This page describes how you can monitor a The Things Stack deployment on AWS ECS.</p>
<p>One of the <a href="https://www.thethingsindustries.com/docs/getting-started/aws/ecs/deployment/">deployment steps</a> was to deploy the &ldquo;Monitoring&rdquo; stack. This installed <a href="https://prometheus.io/">Prometheus</a> into your cluster.</p>
<p>The provided Prometheus image already comes with a number of recording and alerting rules that are useful for most (if not all) deployments.</p>
<h2 id="alerts">Alerts</h2>
<p>For all ECS services that form your The Things Stack deployment, the following alerts are defined:</p>
<ul>
<li><code>NoIdentityServers</code> (The cluster does not have any Identity Server instances). This means that there are no ECS tasks for the Identity Server component.</li>
<li><code>SomeIdentityServersDown</code> (Some Identity Server instances of The Things Enterprise Stack are down). This means that some of the Identity Server instances are not responding. In many cases the deployment will still be online, as requests are routed to other instances.</li>
<li><code>AllIdentityServersDown</code> (All Identity Server instances of The Things Enterprise Stack are down). This means that none of the Identity Server instances is responding.</li>
</ul>
<p>Similar alerts are defined for the Gateway Server, Network Server, Application Server, Join Server, etc.</p>
<p>For the deployment as a whole, the following alerts are defined:</p>
<ul>
<li><code>InternalServerErrors</code> (An instance is returning responses with 500 codes).</li>
<li><code>UpcomingCertificateExpiry</code> (A TLS certificate expires in less than 14 days).</li>
<li><code>CertificateExpired</code> (A TLS certificate has expired).</li>
<li><code>IncreasedLatency</code> (An instance is experiencing increased latency).</li>
<li><code>UpcomingLicenseExpiry</code> (The Things Enterprise Stack license expires in less than 14 days).</li>
<li><code>LicenseExpired</code> (The Things Enterprise Stack license expired).</li>
</ul>
<p>For several components there are alerts that fire when traffic patterns deviate from &ldquo;usual&rdquo; traffic:</p>
<ul>
<li><code>GatewayServerReceivedUplinkTrafficDrop</code> (The Gateway Server of The Things Enterprise Stack received less uplink traffic than usual). This alert includes the protocol (UDP, MQTT, WS), so make sure to look at that when this alert fires.</li>
<li><code>GatewayServerForwardedUplinkTrafficDrop</code> (The Gateway Server of The Things Enterprise Stack forwarded less uplink traffic than usual). This alert includes the host (cluster, packet broker), so make sure to look at that when this alert fires. If the host is &ldquo;cluster&rdquo;, there may be an issue with the Network Server. If the host is &ldquo;packetbroker&rdquo;, there may be an issue with the Packet Broker Agent.</li>
<li><code>NetworkServerReceivedUplinkTrafficDrop</code> (The Network Server of The Things Enterprise Stack received less uplink traffic than usual).</li>
<li><code>ApplicationServerReceivedUplinkTrafficDrop</code> (The Application Server of The Things Enterprise Stack received less uplink traffic than usual).</li>
</ul>
<p>Similar alerts for downlink traffic will be added in the future.</p>
<h2 id="metrics">Metrics</h2>
<p>In addition to the <a href="https://www.thethingsindustries.com/docs/reference/telemetry/">metrics exported by The Things Stack</a>, the provided Prometheus image adds a number of recording rules that provide the input for the previously described alerting rules, but can also be useful in your dashboards.</p>
<p>For all services the following metrics are recorded:</p>
<ul>
<li><code>ttn_lw_log_log_messages_rate</code> records the rate of log messages by job (service), namespace and level. This can be useful for monitoring warning and error rates.</li>
<li><code>ttn_lw_events_publishes_rate</code> records the rate of published events by event name.</li>
</ul>
<p>For the Gateway Server:</p>
<ul>
<li><code>ttn_lw_gs_connected_gateways:by_protocol</code> and <code>ttn_lw_gs_connected_gateways:by_tenant_id</code> record the number of connected gateways in the cluster.</li>
<li><code>ttn_lw_gs_uplink_received_rate:by_protocol</code> and <code>ttn_lw_gs_uplink_received_rate:by_tenant_id</code> record the rate of uplink messages received by the Gateway Server.</li>
<li><code>ttn_lw_gs_downlink_sent_rate:by_protocol</code> and <code>ttn_lw_gs_downlink_sent_rate:by_tenant_id</code> record the rate of downlink messages sent by the Gateway Server.</li>
<li><code>ttn_lw_gs_status_received_rate:by_protocol</code> and <code>ttn_lw_gs_status_received_rate:by_tenant_id</code> record the rate of status message received by the Gateway Server.</li>
<li><code>ttn_lw_gs_uplink_forwarded_rate:by_host</code> and <code>ttn_lw_gs_uplink_forwarded_rate:by_tenant_id</code> record the rate of messages forwarded to the Network Server or Packet Broker. The <code>by_tenant_id</code> only considers messages forwarded to the Network Server.</li>
<li><code>ttn_lw_gs_uplink_dropped_rate:by_host</code> and <code>ttn_lw_gs_uplink_dropped_rate:by_tenant_id</code> record the rate of messages that are dropped for various reasons.</li>
</ul>
<p>For some of these metrics, there are also variants with <code>:avg</code> and <code>:stddev</code> suffixes that can be used for anomaly detection, and are therefore also used in alerting rules.</p>
<p>For the Packet Broker Agent: <span class="new-in-version">New in 3.11.2</span>

</p>
<ul>
<li><code>ttn_lw_pba_uplink_received_rate</code> record the rate of uplink messages received from Packet Broker (as a home network).</li>
<li><code>ttn_lw_pba_downlink_forwarded_rate</code> record the rate of downlink messages sent to Packet Broker (as a home network).</li>
<li><code>ttn_lw_pba_downlink_received_rate</code> record the rate of downlink messages received from Packet Broker (as a forwarder).</li>
<li><code>ttn_lw_pba_uplink_forwarded_rate</code> record the rate of uplink messages sent to Packet Broker (as a forwarder).</li>
</ul>
<p>For the Network Server:</p>
<ul>
<li><code>ttn_lw_ns_uplink_received_rate</code> and <code>ttn_lw_ns_uplink_received_rate:by_tenant_id</code> record the rate of uplink messages received from the Gateway Server or Packet Broker.</li>
<li><code>ttn_lw_ns_uplink_duplicates_rate:by_tenant_id</code> records the rate of duplicate uplinks that are merged into a single uplink.</li>
<li><code>ttn_lw_ns_uplink_processed_rate</code> and <code>ttn_lw_ns_uplink_processed_rate:by_tenant_id</code> record the rate of processed uplinks, meaning uplinks that are matched to a device.</li>
<li><code>ttn_lw_ns_uplink_forwarded_rate</code> and <code>ttn_lw_ns_uplink_forwarded_rate:by_tenant_id</code> record the rate of uplinks forwarded to an Application Server.</li>
<li><code>ttn_lw_ns_uplink_dropped_rate:by_tenant_id</code> records the rate of uplinks that are dropped for various reasons.</li>
<li><code>ttn_lw_ns_downlink_attempted_rate</code> and <code>ttn_lw_ns_downlink_attempted_rate:by_tenant_id</code> record the rate of attempted downlink messages; <code>ttn_lw_ns_downlink_forwarded_rate</code> and <code>ttn_lw_ns_downlink_forwarded_rate:by_tenant_id</code> the rate of forwarded downlink messages.</li>
</ul>
<p>For some of these metrics, there are also variants with <code>:avg</code> and <code>:stddev</code> suffixes that can be used for anomaly detection, and are therefore also used in alerting rules.</p>
<p>For the Application Server:</p>
<ul>
<li><code>ttn_lw_as_subscriptions:by_protocol</code> and <code>ttn_lw_as_subscriptions:by_tenant_id</code> record the number of active uplink subscriptions from integrations and external applications.</li>
<li><code>ttn_lw_as_pubsub_integrations:by_provider</code> and <code>ttn_lw_as_pubsub_integrations:by_tenant_id</code> record the number of active pub/sub integrations.</li>
<li><code>ttn_lw_as_uplink_received_rate</code> and <code>ttn_lw_as_uplink_received_rate:by_tenant_id</code> record the rate of uplink messages received from the Network Server.</li>
<li><code>ttn_lw_as_uplink_forwarded_rate</code> and <code>ttn_lw_as_uplink_forwarded_rate:by_tenant_id</code> record the rate of uplink messages forwarded to integrations and external applications.</li>
<li><code>ttn_lw_as_uplink_dropped_rate:by_tenant_id</code> records the rate of uplink messages dropped for various reasons.</li>
<li><code>ttn_lw_as_downlink_received_rate</code> and <code>ttn_lw_as_downlink_received_rate:by_tenant_id</code> record the rate of downlink messages received from integrations and external applications.</li>
<li><code>ttn_lw_as_downlink_forwarded_rate</code> and <code>ttn_lw_as_downlink_forwarded_rate:by_tenant_id</code> record the rate of downlink messages forwarded to the Network Server.</li>
<li><code>ttn_lw_as_downlink_dropped_rate:by_tenant_id</code> records the rate of downlink messages dropped for various reasons.</li>
</ul>
<p>For some of these metrics, there are also variants with <code>:avg</code> and <code>:stddev</code> suffixes that can be used for anomaly detection, and are therefore also used in alerting rules.</p>
<p>For the Join Server:</p>
<ul>
<li><code>ttn_lw_js_join_accepted_rate:by_tenant_id</code> and <code>ttn_lw_js_join_rejected_rate:by_tenant_id</code> record the rate of accepted and rejected join requests.</li>
</ul>
</div>

<div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/getting-started/aws/ecs/database-operations/">← Database Operations</a>
</div>

<script>window.emojicom_widget = { campaign: "" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
</div>


      </div>
      <div class="column is-hidden-touch is-one-quarter is-one-fifth-widescreen sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      <li><a href='#alerts'>Alerts</a></li>
    
      <li><a href='#metrics'>Metrics</a></li>
    
  </ul>


  </nav>

      </div>
  </div>
</div>


<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/network-and-routing/v3">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Hylke Visser on 10 Mar 2021.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/941e37ea96f0fe564c6130e271fc56257f32ea62">
      doc: Add PBA telemetry descriptions
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/getting-started/aws/ecs/monitoring/_index.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.595b97b16778e75a16096b7412b5ce1e7fff37a56e4e45e7f89921711a3cd177.js" integrity="sha256-WVuXsWd451oWCWt0ErXOHn//N6VuTkXn&#43;JkhcRo80Xc=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
