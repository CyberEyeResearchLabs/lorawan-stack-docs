<!DOCTYPE html>

<html class="has-navbar-fixed-top">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <meta name="generator" content="Hugo 0.70.0" />
  <title>Class B | The Things Stack for LoRaWAN</title><link rel="canonical" href="https://www.thethingsindustries.com/docs/devices/class-b/" />
  <link rel="alternate icon" href="/docs/favicon.ico">
  <link rel="alternate icon" type="image/png" href="/docs/favicon.png">
  <link rel="icon" type="image/svg+xml" href="/docs/favicon.svg">
  <link rel="stylesheet" href="https://www.thethingsindustries.com/docs/css/theme.min.448201dae984e04b2579a9ee482b5768bcd23d222184681e69f3a8b1146f3bb2.css" integrity="sha256-RIIB2umE4EsleanuSCtXaLzSPSIhhGgeafOosRRvO7I=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" />
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta itemprop="name" content="Class B">
  <meta itemprop="description" content="">
  <meta itemprop="keywords" content="">
  <meta property="og:title" content="Class B">
  <meta property="og:description" content="">
  <meta property="og:url" content="https://www.thethingsindustries.com/docs/devices/class-b/">
  <meta name="twitter:title" content="Class B" />
  <meta name="twitter:description" content="" />
  <meta name="twitter:card" content="summary" />
</head>
<body><nav class="navbar is-fixed-top" role="navigation" aria-label="main navigation">
  <div class="container is-fluid">
    <div class="navbar-brand">
      <a class="navbar-item" href="/docs/">
        <img class="logo" src="/docs/img/TTS-logo.svg">
        <p class="navbar-item is-size-7">v3.13</p>
      </a>
      <span class="navbar-burger burger" data-target="topMenu">
        <span></span>
        <span></span>
        <span></span>
      </span>
    </div>
    <div id="topMenu" class="navbar-menu">
      <div class="navbar-start">
        <a class="navbar-item" href="/docs/getting-started/">Getting Started</a>
        <a class="navbar-item" href="/docs/devices/">Devices</a>
        <a class="navbar-item" href="/docs/gateways/">Gateways</a>
        <a class="navbar-item" href="/docs/integrations/">Integrations</a>
        <a class="navbar-item" href="/docs/reference/">Reference</a>
      </div>
      <div class="navbar-end"><div class="navbar-item">
            <a class="button is-primary" href="/docs/download/">Get The Things Stack</a>
          </div>
      </div>
    </div>
  </div>
</nav>
<section class="search-container">
    <div class="container">
      <div class="columns is-vcentered">
        <div class="column">
          <div class="field has-addons has-addons-centered">
            <div class="control">
              <input class="input search-bar" id="search-input" type="text" placeholder="Search" type="text">
            </div>
          </div>
        </div>
      </div>
    </div>
</section>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
<script type="text/javascript"> docsearch({
apiKey: "",
indexName: "thethingsstack",
inputSelector: '#search-input',
debug: false 
});
</script>
<div class="container" role="document">
  <div class="columns my-0">
      <div class="column is-one-fifth-tablet is-one-third sidebar-left">
        

<nav class="side-navigation" aria-label="Main navigation">

<h2 class="title is-size-5">Devices</h2>

<ul class="menu-list">
<a href="https://www.thethingsindustries.com/docs/devices/" class="">Overview</a>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/abp-vs-otaa/" class="">ABP vs OTAA</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/adding-devices/" class="">Adding Devices</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/atecc608a/" class="">ATECC608A/B Secure Elements</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/best-practices/" class="">Best Practices</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/class-b/" class="is-active">Class B</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/class-c/" class="">Class C</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/device-claiming/" class="">Device Claiming</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/downlink-queue-ops/" class="">Downlink Queue Operations</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/end-device-templates/" class="">End Device Templates</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/generate-qr-code/" class="">Generating a QR Code</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/mac-settings/" class="">MAC Settings</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/multicast/" class="">Multicast</a>
  </li>
<li>
    <a href="https://www.thethingsindustries.com/docs/devices/troubleshooting/" class="">Troubleshooting Devices</a>
  </li>
</ul>



</nav>








      </div>
      <div class="column sidebar-middle">

<div class="docs-content">
<h1 class="title is-size-2">Class B
  
  
  
  
</h1>

<div class="content">
  <p>Class B end devices listen for downlink messages during ping slots. This allows applications to send messages to devices at predefined time slots, rather than waiting for a Class A uplink. When combined with <a href="https://www.thethingsindustries.com/docs/devices/multicast/">multicast groups</a>, this allows applications to send periodic downlinks to many devices at the same time.</p>
<h2 id="enabling-and-disabling-class-b">Enabling and Disabling Class B</h2>
<p>In order to send Class B downlink messages to a single device, enable Class B support for the end device when creating or updating it with the <code>--supports-class-b</code> flag.</p>
<p>For example, when enabling Class B for an existing device:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttn-lw-cli end-devices <span class="nb">set</span> app1 dev1 --supports-class-b
</code></pre></div><p>This will enable the Class B downlink scheduling of the device. Downlink messages are now scheduled during the next available ping slot.</p>
<p>To disable Class B scheduling, reset with <code>--supports-class-b=false</code>.</p>
<div class="notification is-info is-light has-text-dark">
  <h5 class="title is-family-sans-serif has-text-dark mb-1">Note:</h5>
  For unicast devices, Class B downlink scheduling starts when the end device sends an uplink with the Class B bit set. This means that an OTAA device should send an uplink message with the Class B bit set after receiving the join-accept in order to enable Class B downlink scheduling.
</div>

<h2 id="multicast-group">Multicast Group</h2>
<p>See <a href="https://www.thethingsindustries.com/docs/devices/multicast/">Multicast</a> for instructions for creating and using multicast groups.</p>
<h2 id="class-b-message-settings">Class B Message Settings</h2>
<p>The Things Stack supports optional settings for Class B downlink messages: the downlink path and the time to send the message.</p>
<p>The downlink path is defined by one or more gateways IDs. The Network Server and Gateway Server schedules only on the specified gateways in the specified order. This is useful for multicast (where no downlink path is known because there is no uplink). A scheduling attempt can fail when the gateway is not connected, if there is a scheduling conflict or if duty-cycle regulations prohibit transmission.</p>
<p>The time to transmit is an absolute timestamp in ISO 8601 format to send the message. This requires gateways either with GPS lock, or gateways that use a protocol that provide round-trip times (RTT). See the <a href="#example">Example</a> section below.</p>
<h2 id="example">Example</h2>
<div class="notification is-primary is-light has-text-dark">
  <h3 class="title has-text-dark mb-1">Command-line interface only</h3>
  <p>The instructions below use the command-line interface (CLI).</p>
  
  <div class="buttons">
    <a class="button is-dark is-outlined" href="https://www.thethingsindustries.com/docs/getting-started/cli/installing-cli/">Learn how to install the CLI</a>
  </div>
</div>

<p>First, create a Class B device:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ ttn-lw-cli end-devices create app1 dev1 <span class="se">\
</span><span class="se"></span>  --frequency-plan-id EU_863_870 <span class="se">\
</span><span class="se"></span>  --lorawan-version 1.0.3 <span class="se">\
</span><span class="se"></span>  --lorawan-phy-version 1.0.3-a <span class="se">\
</span><span class="se"></span>  --session.dev-addr 00E4304D <span class="se">\
</span><span class="se"></span>  --session.keys.app-s-key.key A0CAD5A30036DBE03096EB67CA975BAA <span class="se">\
</span><span class="se"></span>  --session.keys.nwk-s-key.key B7F3E161BC9D4388E6C788A0C547F255 <span class="se">\
</span><span class="se"></span>  --supports-class-b
</code></pre></div><p>Then, schedule the following message to the <a href="https://www.thethingsindustries.com/docs/integrations/mqtt/">Application Server MQTT server</a> or <a href="https://www.thethingsindustries.com/docs/integrations/webhooks/">HTTP webhooks</a>:</p>
<div class="highlight"><pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
  <span class="nt">&#34;downlinks&#34;</span><span class="p">:</span> <span class="p">[{</span>
    <span class="nt">&#34;frm_payload&#34;</span><span class="p">:</span> <span class="s2">&#34;vu8=&#34;</span><span class="p">,</span>
    <span class="nt">&#34;f_port&#34;</span><span class="p">:</span> <span class="mi">42</span><span class="p">,</span>
    <span class="nt">&#34;priority&#34;</span><span class="p">:</span> <span class="s2">&#34;NORMAL&#34;</span><span class="p">,</span>
    <span class="nt">&#34;class_b_c&#34;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&#34;gateways&#34;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nt">&#34;gateway_ids&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;gateway_id&#34;</span><span class="p">:</span> <span class="s2">&#34;gtw1&#34;</span>
          <span class="p">},</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="nt">&#34;gateway_ids&#34;</span><span class="p">:</span> <span class="p">{</span>
            <span class="nt">&#34;gateway_id&#34;</span><span class="p">:</span> <span class="s2">&#34;gtw2&#34;</span>
          <span class="p">},</span>
        <span class="p">}</span>
      <span class="p">],</span>
      <span class="nt">&#34;absolute_time&#34;</span><span class="p">:</span> <span class="s2">&#34;2019-07-23T13:05:00Z&#34;</span>
    <span class="p">}</span>
  <span class="p">}]</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="is-clearfix">
<a class="button is-pulled-left" href="/docs/devices/best-practices/">← Best Practices</a>
<a class="button is-pulled-right" href="/docs/devices/class-c/">Class C →</a>
</div>

<script>window.emojicom_widget = { campaign: "" };</script>
<script src="https://cdn.emojicom.io/embed/widget.js" async></script>

<div class='feedback has-vertical-space'>
  <div id="emojicom-widget-inline"></div>
</div>
</div>


      </div>
      <div class="column is-hidden-touch is-one-quarter is-one-fifth-widescreen sidebar-right">
        <nav class="toc" aria-label="Page navigation">
    <h2 class="title is-size-6">On this page</h2>
    


  <ul class="menu-list">
    
      
      <li><a href='#enabling-and-disabling-class-b'>Enabling and Disabling Class B</a></li>
    
      
      <li><a href='#multicast-group'>Multicast Group</a></li>
    
      
      <li><a href='#class-b-message-settings'>Class B Message Settings</a></li>
    
      
      <li><a href='#example'>Example</a></li>
    
  </ul>


  </nav>

      </div>
  </div>
</div>


<footer class="footer">
  <div class="container">
    <div class="columns">
      <nav class="column is-one-quarter">
        <h3 class="title is-6">The Things Stack</h3>
        <p><a class="" href="/docs/getting-started/">Getting Started</a></p>
        <p><a class="" href="/docs/devices/">Devices</a></p>
        <p><a class="" href="/docs/gateways/">Gateways</a></p>
        <p><a class="" href="/docs/integrations/">Integrations</a></p>
        <p><a class="" href="/docs/reference/">Reference</a></p>
      </nav>
      <nav class="column is-one-quarter">
        <h3 class="title is-6">Contributing</h3>
        <p><a class="" href="https://github.com/TheThingsIndustries/lorawan-stack-docs">GitHub</a></p>
        <p><a class="" href="https://www.thethingsnetwork.org/forum/c/network-and-routing/v3">Forum</a></p>
      </nav>
      
      <nav class="column is-one-quarter">
        <h3 class="title is-6">About Us</h3>
        <p><a class="" href="https://www.thethingsnetwork.org">The Things Network</a></p>
        <p><a class="" href="https://www.thethingsindustries.com">The Things Industries</a></p>
      </nav>
      <div class="column is-one-quarter">
        <h3 class="title is-6">About this page</h3>
        <div class="content">
<p class="is-size-7">
  Last changed by Ben Olayinka on 25 Feb 2021.
  <br>
  <a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/commit/3ae3ae575f74883b422051dd13e733aa3b9f9fbc">
      doc: Add Class B doc
    </a>
</p>

<a href="https://github.com/TheThingsIndustries/lorawan-stack-docs/blob/master/doc/content/devices/class-b/index.md" class="button">Edit on Github</a>
</div>

      </div>
    </div>
  </div>
</footer>
<script src="https://www.thethingsindustries.com/docs/js/vendor/basicLightbox.min.js"></script>
<script src="https://www.thethingsindustries.com/docs/js/theme.min.af1cdce2271a42369c7c022fb683df665bf882e1fdc766a89a6ee99196bc4f9e.js" integrity="sha256-rxzc4icaQjacfAIvtoPfZlv4guH9x2aomm7pkZa8T54=" crossorigin="anonymous"></script><script>
  window.intercomSettings = {
    app_id: "",
  };
</script>

<script>
(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})();
</script>

</body>

</html>
